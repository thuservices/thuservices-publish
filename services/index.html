
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="A yellow page for Tsinghua/THU service/info/utils">
      
      
      
      
        <link rel="prev" href="../info/">
      
      
        <link rel="next" href="../utils/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.2">
    
    
      
        <title>服务 - THU Services</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.d7758b05.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#linux" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href=".." title="THU Services" class="md-header__button md-logo" aria-label="THU Services" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            THU Services
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              服务
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Auto"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Auto" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="purple"  aria-label="Light Mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Light Mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="lime"  aria-label="Dark Mode"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Dark Mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
        <button type="reset" class="md-search__icon md-icon" title="清空当前内容" aria-label="清空当前内容" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/ZenithalHourlyRate/thuservices" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    ZenithalHourlyRate/thuservices
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="THU Services" class="md-nav__button md-logo" aria-label="THU Services" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    THU Services
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/ZenithalHourlyRate/thuservices" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    ZenithalHourlyRate/thuservices
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" checked>
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    THU Services
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            THU Services
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    目录
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../info/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    信息
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    服务
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    服务
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#dnsntp" class="md-nav__link">
    <span class="md-ellipsis">
      DNS/NTP
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sslvpn" class="md-nav__link">
    <span class="md-ellipsis">
      SSLVPN
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      上网认证
    </span>
  </a>
  
    <nav class="md-nav" aria-label="上网认证">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      校园网基础知识
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      命令行认证 自动认证
    </span>
  </a>
  
    <nav class="md-nav" aria-label="命令行认证 自动认证">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      命令行认证
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      自动认证
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#windows" class="md-nav__link">
    <span class="md-ellipsis">
      自动认证 （Windows）
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      远端服务器代认证
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      远端服务器网页认证
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tsinghua-secure" class="md-nav__link">
    <span class="md-ellipsis">
      Tsinghua-Secure
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Tsinghua-Secure">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#networkmanager" class="md-nav__link">
    <span class="md-ellipsis">
      NetworkManager
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wpa_supplicant" class="md-nav__link">
    <span class="md-ellipsis">
      wpa_supplicant
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#iwd" class="md-nav__link">
    <span class="md-ellipsis">
      iwd
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tsinghua-secure_1" class="md-nav__link">
    <span class="md-ellipsis">
      Tsinghua-Secure 仅校内登录方式
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      校园网特性讨论
    </span>
  </a>
  
    <nav class="md-nav" aria-label="校园网特性讨论">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    <span class="md-ellipsis">
      二层隔离/邻居发现隔离
    </span>
  </a>
  
    <nav class="md-nav" aria-label="二层隔离/邻居发现隔离">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ipv4" class="md-nav__link">
    <span class="md-ellipsis">
      IPv4
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ipv6" class="md-nav__link">
    <span class="md-ellipsis">
      IPv6
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    <span class="md-ellipsis">
      低端口阻断
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ip" class="md-nav__link">
    <span class="md-ellipsis">
      动态 IP
    </span>
  </a>
  
    <nav class="md-nav" aria-label="动态 IP">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ipv6-ipv6" class="md-nav__link">
    <span class="md-ellipsis">
      IPv6 静态后缀或短 IPv6 地址
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ipv4ipv6" class="md-nav__link">
    <span class="md-ellipsis">
      尝试获取某一特定IPv4、IPv6地址
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ipv6_1" class="md-nav__link">
    <span class="md-ellipsis">
      院系网（三层接入）的 IPv6
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#systemd-networkd-ipv4" class="md-nav__link">
    <span class="md-ellipsis">
      systemd-networkd 有线连接时无法获取 ipv4 地址
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rfc-dhcpv6" class="md-nav__link">
    <span class="md-ellipsis">
      不符合 RFC 的 DHCPv6
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#30" class="md-nav__link">
    <span class="md-ellipsis">
      30分钟无流量掉准入
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    <span class="md-ellipsis">
      掉准出后无法准出
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    <span class="md-ellipsis">
      准入后（仅校内登录后）无法准出
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ping-ssh" class="md-nav__link">
    <span class="md-ellipsis">
      未准入时其他机器能 ping 通，但不能 ssh
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dns" class="md-nav__link">
    <span class="md-ellipsis">
      DNS 拦截
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    <span class="md-ellipsis">
      清华云盘
    </span>
  </a>
  
    <nav class="md-nav" aria-label="清华云盘">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#terminal" class="md-nav__link">
    <span class="md-ellipsis">
      使用 Terminal 客户端
    </span>
  </a>
  
    <nav class="md-nav" aria-label="使用 Terminal 客户端">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#token" class="md-nav__link">
    <span class="md-ellipsis">
      获取 Token
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#token_1" class="md-nav__link">
    <span class="md-ellipsis">
      替换部分文件实现 Token 登录
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#terminal_1" class="md-nav__link">
    <span class="md-ellipsis">
      编译 Terminal 客户端
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chrome" class="md-nav__link">
    <span class="md-ellipsis">
      Chrome 提醒下载的文件危险
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#isatap" class="md-nav__link">
    <span class="md-ellipsis">
      ISATAP（已停止）
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ISATAP（已停止）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ipv6pt" class="md-nav__link">
    <span class="md-ellipsis">
      获取IPv6挂PT
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#win-10" class="md-nav__link">
    <span class="md-ellipsis">
      WIN 10 激活
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    <span class="md-ellipsis">
      正版操作系统与软件下载
    </span>
  </a>
  
    <nav class="md-nav" aria-label="正版操作系统与软件下载">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#its" class="md-nav__link">
    <span class="md-ellipsis">
      ITS
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tuna" class="md-nav__link">
    <span class="md-ellipsis">
      TUNA
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ip_1" class="md-nav__link">
    <span class="md-ellipsis">
      校内 IP 段
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../utils/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    工具
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../templates/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    模板
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../websites/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    网站
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../accounts/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    公号
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#dnsntp" class="md-nav__link">
    <span class="md-ellipsis">
      DNS/NTP
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sslvpn" class="md-nav__link">
    <span class="md-ellipsis">
      SSLVPN
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      上网认证
    </span>
  </a>
  
    <nav class="md-nav" aria-label="上网认证">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      校园网基础知识
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      命令行认证 自动认证
    </span>
  </a>
  
    <nav class="md-nav" aria-label="命令行认证 自动认证">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      命令行认证
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      自动认证
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#windows" class="md-nav__link">
    <span class="md-ellipsis">
      自动认证 （Windows）
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      远端服务器代认证
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      远端服务器网页认证
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tsinghua-secure" class="md-nav__link">
    <span class="md-ellipsis">
      Tsinghua-Secure
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Tsinghua-Secure">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#networkmanager" class="md-nav__link">
    <span class="md-ellipsis">
      NetworkManager
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wpa_supplicant" class="md-nav__link">
    <span class="md-ellipsis">
      wpa_supplicant
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#iwd" class="md-nav__link">
    <span class="md-ellipsis">
      iwd
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tsinghua-secure_1" class="md-nav__link">
    <span class="md-ellipsis">
      Tsinghua-Secure 仅校内登录方式
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      校园网特性讨论
    </span>
  </a>
  
    <nav class="md-nav" aria-label="校园网特性讨论">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    <span class="md-ellipsis">
      二层隔离/邻居发现隔离
    </span>
  </a>
  
    <nav class="md-nav" aria-label="二层隔离/邻居发现隔离">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ipv4" class="md-nav__link">
    <span class="md-ellipsis">
      IPv4
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ipv6" class="md-nav__link">
    <span class="md-ellipsis">
      IPv6
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    <span class="md-ellipsis">
      低端口阻断
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ip" class="md-nav__link">
    <span class="md-ellipsis">
      动态 IP
    </span>
  </a>
  
    <nav class="md-nav" aria-label="动态 IP">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ipv6-ipv6" class="md-nav__link">
    <span class="md-ellipsis">
      IPv6 静态后缀或短 IPv6 地址
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ipv4ipv6" class="md-nav__link">
    <span class="md-ellipsis">
      尝试获取某一特定IPv4、IPv6地址
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ipv6_1" class="md-nav__link">
    <span class="md-ellipsis">
      院系网（三层接入）的 IPv6
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#systemd-networkd-ipv4" class="md-nav__link">
    <span class="md-ellipsis">
      systemd-networkd 有线连接时无法获取 ipv4 地址
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rfc-dhcpv6" class="md-nav__link">
    <span class="md-ellipsis">
      不符合 RFC 的 DHCPv6
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#30" class="md-nav__link">
    <span class="md-ellipsis">
      30分钟无流量掉准入
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    <span class="md-ellipsis">
      掉准出后无法准出
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    <span class="md-ellipsis">
      准入后（仅校内登录后）无法准出
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ping-ssh" class="md-nav__link">
    <span class="md-ellipsis">
      未准入时其他机器能 ping 通，但不能 ssh
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dns" class="md-nav__link">
    <span class="md-ellipsis">
      DNS 拦截
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    <span class="md-ellipsis">
      清华云盘
    </span>
  </a>
  
    <nav class="md-nav" aria-label="清华云盘">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#terminal" class="md-nav__link">
    <span class="md-ellipsis">
      使用 Terminal 客户端
    </span>
  </a>
  
    <nav class="md-nav" aria-label="使用 Terminal 客户端">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#token" class="md-nav__link">
    <span class="md-ellipsis">
      获取 Token
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#token_1" class="md-nav__link">
    <span class="md-ellipsis">
      替换部分文件实现 Token 登录
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#terminal_1" class="md-nav__link">
    <span class="md-ellipsis">
      编译 Terminal 客户端
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chrome" class="md-nav__link">
    <span class="md-ellipsis">
      Chrome 提醒下载的文件危险
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#isatap" class="md-nav__link">
    <span class="md-ellipsis">
      ISATAP（已停止）
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ISATAP（已停止）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ipv6pt" class="md-nav__link">
    <span class="md-ellipsis">
      获取IPv6挂PT
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#win-10" class="md-nav__link">
    <span class="md-ellipsis">
      WIN 10 激活
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    <span class="md-ellipsis">
      正版操作系统与软件下载
    </span>
  </a>
  
    <nav class="md-nav" aria-label="正版操作系统与软件下载">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#its" class="md-nav__link">
    <span class="md-ellipsis">
      ITS
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tuna" class="md-nav__link">
    <span class="md-ellipsis">
      TUNA
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ip_1" class="md-nav__link">
    <span class="md-ellipsis">
      校内 IP 段
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="linux">清华服务使用指北（主要面向 Linux 用户）<a class="headerlink" href="#linux" title="Permanent link">&para;</a></h1>
<p>本文将重点关注清华一些服务在 Linux 机器，包括远端服务器上的使用说明</p>
<p>以及校园专供 Windows 10 的激活指南</p>
<h2 id="dnsntp">DNS/NTP<a class="headerlink" href="#dnsntp" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code>166.111.8.28
166.111.8.29
2402:f000:1:801::8:28
2402:f000:1:801::8:29
</code></pre></div>
<p>按照校园网建议，在配置 DNS 和 NTP 时，至少要使用校园网提供的服务。</p>
<p>目前，校园网内只能使用校园网提供的 DNS，其余 DNS 不保证工作。</p>
<p>对于更多校园网 DNS 特性及可能可用的公共 DNS 服务，参考 <a href="#dns-拦截">DNS 拦截</a></p>
<h2 id="sslvpn">SSLVPN<a class="headerlink" href="#sslvpn" title="Permanent link">&para;</a></h2>
<p>在 Linux 机器上没有 PULSE SECURE 客户端，除了可以使用 WEB VPN 外，也可使用 <code>openconnect</code> 来做到连接清华VPN。</p>
<p>若是 Debian 系，包括 Ubuntu，可以使用</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>openconnect
</code></pre></div>
<p>若是 Arch Linux，可以使用</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>pacman<span class="w"> </span>-S<span class="w"> </span>openconnect
</code></pre></div>
<p>安装此软件。其余发行版请自行查阅相应源。</p>
<p>安装完毕后，使用</p>
<blockquote>
<p>$ openconnect --juniper <a href="https://sslvpn.tsinghua.edu.cn">https://sslvpn.tsinghua.edu.cn</a>
</p>
</blockquote>
<p>指定协议为 Juniper 的情况下，客户端不会被分配 IPv6 地址，如果改成 Pulse Connect Secure 则可以获取到一个 IPv6 地址。同时还需要指定 UserAgent 才能正确地获取 IPv6 路由，否则会尝试将所有 IPv6 流量路由到 VPN。</p>
<p>用如下的方式可以正确获取 IPv6 地址和路由（具体是 2402:f000::/32）：</p>
<div class="highlight"><pre><span></span><code>openconnect<span class="w"> </span>--protocol<span class="o">=</span>pulse<span class="w"> </span>https://sslvpn.tsinghua.edu.cn<span class="w"> </span>--useragent<span class="w"> </span>Pulse-Secure/9.1.11.6725
</code></pre></div>
<p>输入帐号和密码后即连接上校园网，可以访问校内服务（INFO/USEREG）。</p>
<p>值得注意的是，与清华无关的流量依旧按照原有路由发出，此行为与 Windows 下不同。（此项需求证）</p>
<h2 id="_1">上网认证<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h2>
<h3 id="_2">校园网基础知识<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h3>
<p><a href="https://its.tsinghua.edu.cn/helpsystem/train/CampusNetworkLectureNotes201909.pdf">清华大学校园网使用简介</a>（由于网页升级链接已失效，可参阅本站的<a href="../file/CampusNetworkLectureNotes201909.pdf">备份</a>）</p>
<p><a href="http://166.111.5.8/commsoft/helpsystem/wirednetwork/RealNameAuthentication20190121.pdf">准入上网使用说明</a>（本站<a href="../file/RealNameAuthentication20190121.pdf">备份</a>）</p>
<p><a href="https://its.tsinghua.edu.cn/helpsystem/wirednetwork/RealNameAuthenticationFAQ20190614.pdf">清华大学校园网有线局域网用户准入系统使用说明（问与答）</a>（由于网页升级链接已失效，可参阅本站的<a href="../file/RealNameAuthenticationFAQ20190614.pdf">备份</a>）</p>
<p>上述文件太长不看版：在校园网中上网分为两步，一步是准入，另一步是准出。</p>
<p>没有准入与准出时，机器只能 ping 通 <code>166.111.8.28</code> 与 <code>2402:f000:1:801::8:28</code>，如果你有相应 v4 与 v6 地址。校内其他地址不通。</p>
<p>对于 IPv4 而言，当有准入而没有准出时，机器可以 ping 通校内机器，但不能 ping 通校外机器，即不能上外网。只有当有准入而且有准出时，机器可以连接外网。</p>
<p>对于 IPv6 而言，v6 只有准入这一步，有了准入，即可以连接外网。</p>
<p>对于 2 层接入的机器（紫荆宿舍网，教学楼无线网络，一些院系的网络），v4 认证与 v6 认证是联动进行的，即当 v4 准入时，v6 同时也准入。对于 3 层接入的机器（一些院系的网络），v4 与 v6 需要分别准入。</p>
<p><code>Tsinghua-Secure</code> 使用的是另一套认证系统。</p>
<h3 id="_3">命令行认证 自动认证<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h3>
<p>参见 <a href="../utils/">utils.md</a> 中的认证工具汇总。</p>
<p>以下参考 <a href="https://github.com/z4yx/GoAuthing">GoAuthing</a></p>
<h4 id="_4">命令行认证<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h4>
<p>该软件实现了七个主要功能，分别是</p>
<div class="highlight"><pre><span></span><code>auth-thu<span class="w"> </span>auth<span class="w"> </span><span class="c1"># v4准入</span>
auth-thu<span class="w"> </span>deauth<span class="w"> </span><span class="c1"># 解除v4准入</span>
auth-thu<span class="w"> </span>auth<span class="w"> </span>-6<span class="w"> </span><span class="c1"># v6准入</span>
auth-thu<span class="w"> </span>deauth<span class="w"> </span>-6<span class="w"> </span><span class="c1"># 解除v6准入</span>
auth-thu<span class="w"> </span>login<span class="w"> </span><span class="c1"># v4准出</span>
auth-thu<span class="w"> </span><span class="nb">logout</span><span class="w"> </span><span class="c1"># 解除v4准出</span>
auth-thu<span class="w"> </span>online<span class="w"> </span><span class="c1"># 保持机器在线</span>
</code></pre></div>
<p>普通用户将其放在家目录下，作为命令行工具使用，即可满足大部分认证需求。</p>
<p>已知问题：在用户通过<code>auth-thu auth -C</code>（仅准入）后调用<code>auth-thu login</code>（仅准出），准出会失败。</p>
<h4 id="_5">自动认证<a class="headerlink" href="#_5" title="Permanent link">&para;</a></h4>
<p>对于系统管理员来说，可能存在服务器实现自动认证的需求。</p>
<p>下载好文件以后请合理放置在相应目录（如 /usr/local/bin）下，同时将配置文件放在合理目录下，即可使用</p>
<p>要做到自动 <strong>准出</strong>，需将其中附带的 <code>goauthing.service</code> 或 <code>goauthing@.service</code> 放置 <code>/etc/systemd/system/</code> 文件夹下 ，并调整相应内容以符合程序文件以及配置文件的路径，使用</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>goauthing.service
</code></pre></div>
<p>启动相应服务，即可达到自动认证的目的。如果要实现账户信息储存在用户家目录中而不是 <code>/etc</code> 中，可以参考 <code>goauthing@.service</code>。</p>
<p>如果要实现 <code>v6</code> 的自动准入，可参考 <code>goauthing6.service</code> 和 <code>goauthing6@.service</code>。如果只要 v4 的自动准入，需要将 <code>goauthing.service</code> 中的 <code>auth</code> 变为 <code>auth -C</code>，且删除 <code>login</code> 一行。</p>
<p>如果有打包者将此打包，请 PR。目前在 AUR 中存在 <code>auth-thu-bin</code> 包（<code>auth-thu</code> 包已经过时）。</p>
<h4 id="windows">自动认证 （Windows）<a class="headerlink" href="#windows" title="Permanent link">&para;</a></h4>
<p>对于 Windows 用户，可以利用任务计划程序库新建开机自动启动的任务，以实现自动认证，可以参考 <a href="https://aajax.top/2024/03/10/GoAuthingWindows/">这篇文章</a> 建立循环执行的登录脚本并设置在开机时启动。</p>
<h3 id="_6">远端服务器代认证<a class="headerlink" href="#_6" title="Permanent link">&para;</a></h3>
<p>（从笔者的经历来看，usereg 的对准入准出成功和失败的反馈较少，建议采用命令行以及网页认证，而只将 usereg 作为状态面板使用）</p>
<p>在某些服务器上无法使用浏览器打开 <a href="https://net.tsinghua.edu.cn">net.tsinghua.edu.cn</a> 来认证，只能使用 <a href="### 命令行认证 自动认证">命令行工具</a> 或「准入代认证」的方式来实现准入。</p>
<p>对于代认证，需要先知道服务器的 IPv4 地址，形如 <code>166.111.x.x</code> 或 <code>59.66.x.x</code> 或 <code>101.x.x.x</code>，之后打开 <a href="https://usereg.tsinghua.edu.cn">usereg.tsinghua.edu.cn</a> 「准入代认证」部分，填入 IP 即可准入，在准入时可以选择是否打开准出。</p>
<p>对于某些三层接入的机器，如果要实现 v6 的准入，也可在「准入代认证」中实现准入。</p>
<p>对于有些服务器存在准入但没有准出的情况，可以使用「连线其他 IP」实现准出。 </p>
<p>关于准入与准出的问题，欢迎 PR。</p>
<p>关于 IPv4 和 IPv6 在准入准出上线与掉线时的表现，以及校内二层接入/三层接入的表现，欢迎 PR</p>
<h3 id="_7">远端服务器网页认证<a class="headerlink" href="#_7" title="Permanent link">&para;</a></h3>
<p>有时 <code>usereg</code> 中的信息并不准确，如果此时还能 <code>ssh</code> 登录机器，除了之前提到的「命令行认证」外，还可以在登录时使用选项</p>
<div class="highlight"><pre><span></span><code>ssh -D &lt;port&gt; host
</code></pre></div>
<p>这样在本地会搭建一个以 <code>&lt;port&gt;</code> 为端口的 socks5 代理，如果在浏览器中使用该代理，即可与往常一样实现网页认证。</p>
<p>尤其要注意的是，不能直接访问 auth4/auth6 来进行认证（参考问与答），需要通过跳转的方式来访问 auth4/auth6 以获取正确的 ac_id. 一般情况下可以访问 info/learn/login 来跳转，也可通过 3.3.3.3 和 [3:3:3::3] 来跳转。后者对于三层接入的用户来说是一个较为方便的访问 auth6 的方案。</p>
<h3 id="tsinghua-secure">Tsinghua-Secure<a class="headerlink" href="#tsinghua-secure" title="Permanent link">&para;</a></h3>
<p>如果是校内环境，首先连接 <code>Tsinghua-Secure无线网使用指南</code> 进入 <a href="https://usereg.tsinghua.edu.cn">usereg.tsinghua.edu.cn</a> , 登录后在 <code>自注册及修改口令处</code> 设置 Tsinghua-Secure 使用的密码，此密码不需要与 info 密码相同。</p>
<h4 id="networkmanager">NetworkManager<a class="headerlink" href="#networkmanager" title="Permanent link">&para;</a></h4>
<p>设置好后，可以使用 <code>NetworkManager</code> 连接该 Wifi，可以参考 its 的文档 <a href="https://its.tsinghua.edu.cn/info/1333/2318.htm">清华大学无线校园网 802.1x 认证登录客户端配置说明</a>（本站<a href="../file/tsinghua-secure-config.pdf">备份</a>）</p>
<p>样例配置 <code>/etc/NetworkManager/system-connections/Tsinghua-Secure.nmconnection</code> 如下</p>
<div class="highlight"><pre><span></span><code>[connection]
id=Tsinghua-Secure
uuid=44638cf4-782e-4aaa-9ab9-f7a7e68de54c
type=wifi
permissions=
timestamp=1661836652

[wifi]
mac-address-blacklist=
mode=infrastructure
seen-bssids=30:7B:AC:09:BF:EB;30:7B:AC:09:DD:8B;30:7B:AC:09:EF:CB;30:7B:AC:0A:18:2B;30:7B:AC:40:7F:CC;30:7B:AC:40:80:AC;30:7B:AC:40:A0:8A;30:7B:AC:65:0D:2B;30:7B:AC:65:22:6B;30:7B:AC:67:A5:4A;30:7B:AC:67:ED:8A;30:7B:AC:67:F5:8A;30:7B:AC:67:FC:4A;30:7B:AC:67:FC:59;30:7B:AC:92:ED:0C;30:7B:AC:93:08:8A;30:7B:AC:93:0F:CC;30:7B:AC:93:1D:6C;30:7B:AC:93:1D:7A;30:7B:AC:93:2B:2C;30:7B:AC:93:32:2C;30:7B:AC:93:33:2C;30:7B:AC:98:C0:CA;30:7B:AC:98:C1:0C;30:7B:AC:98:C1:CA;30:7B:AC:98:C5:6A;30:7B:AC:98:C8:0A;70:D9:31:23:AF:D2;94:28:2E:3F:ED:CA;94:28:2E:40:0E:CA;A8:58:40:5A:66:B2;A8:58:40:5B:7A:D2;A8:58:40:D5:D1:12;A8:58:40:D5:D3:22;A8:58:40:D5:D3:32;A8:58:40:D6:03:F2;A8:58:40:D6:25:F2;A8:58:40:D6:3C:F2;A8:58:40:D6:3F:52;A8:58:40:D6:44:B2;A8:58:40:D6:45:72;A8:58:40:D6:97:12;A8:58:40:D7:14:D2;
ssid=Tsinghua-Secure

[wifi-security]
key-mgmt=wpa-eap

[802-1x]
eap=peap;
identity=&lt;username&gt;@tsinghua
password=&lt;redacted&gt;
phase2-auth=mschapv2

[ipv4]
dns-search=
method=disabled

[ipv6]
addr-gen-mode=eui64
dns-search=
ignore-auto-dns=true
method=auto
token=::114:514:1919:810

[proxy]
</code></pre></div>
<p>该样例配置仅启用了 IPv6 并获取特定后缀（请自行挑选后缀以免地址相撞），同时使用了 <code>@tsinghua</code> 的 <code>identity</code> 以保证不占用准出名额。</p>
<p>特别要注意的是，如果你同时符合下面三个条件：</p>
<ol>
<li><code>NetworkManager</code> 使用了 <code>wpa_supplicant</code> 后端 </li>
<li>使用了 3.0.0 及以上版本的 <code>openssl</code></li>
<li>使用的发行版没有给 <code>wpa_supplicant</code> 打上 <a href="https://launchpad.net/ubuntu/+source/wpa/2:2.10-6ubuntu2">修复 tls 1.0/1.1 连接的 patch</a> （目前确认 Ubuntu 有 patch，NixOS 没有 patch）</li>
</ol>
<p>那么你的 <code>NetworkManager</code> 可能由于 tls 1.0 连接被禁用而连不上 <code>Tsinghua-Secure</code>，此时有以下两种解决方法，任意一种都能解决：</p>
<ol>
<li>升级 NetworkManager 到 <code>1.41.5-dev</code> 及以上，准确的说是确保 <a href="https://gitlab.freedesktop.org/NetworkManager/NetworkManager/-/commit/98dd4180ec163af63fe1e0fda00158ac7f0047df">这个 commit</a> 已经被包含。在上述配置文件的 <code>[802-1x]</code> 一节中加入一行 <code>phase1-auth-flags=32</code>（<code>NetworkManager</code> 中 <code>tls-1-0-enable</code> 这一选项对应 <code>0x20</code>，换算成十进制是 <code>32</code>，这一换算关系目前没有在文档里记录，所以不保证 32 这个数字始终有效。更能保证有效的方法是手动用 <code>nmcli</code> 设置 <code>Tsinghua-Secure</code> 中设置 <code>802-1x.phase1-auth-flags</code> 为 <code>tls-1-0-enable</code>）。</li>
<li>给自己的 <code>wpa_supplicant</code> 打上前面提到的 patch。</li>
</ol>
<h4 id="wpa_supplicant">wpa_supplicant<a class="headerlink" href="#wpa_supplicant" title="Permanent link">&para;</a></h4>
<p>也可使用 <code>wpa_supplicant</code> 完成相应 wifi 连接。安装 <code>wpa_supplicant</code>，编辑 <code>/etc/wpa_supplicant/wpa_supplicant-nl80211-XXXX.conf</code>， 其中 <code>XXXX</code> 是本机网卡名称，输入以下配置</p>
<div class="highlight"><pre><span></span><code>ctrl_interface=/var/run/wpa_supplicant
update_config=1

network={
        ssid=&quot;Tsinghua-Secure&quot;
        proto=RSN
        key_mgmt=WPA-EAP
        pairwise=CCMP
        eap=PEAP
        identity=&quot;username&quot;
        password=&quot;password&quot;
        # 使用 3.0.0 及以上版本的 openssl，同时发行版没有打上相应 patch 的话（参见上一节），tls 1.0/1.1 会被默认禁用，无法连接 Tsinghua-Secure。下面这行可以解除禁用
        phase1=&quot;tls_disable_tlsv1_0=0&quot;
        phase2=&quot;auth=MSCHAPV2&quot;
        priority=9
}     
</code></pre></div>
<p>其中 <code>username</code> 与 <code>password</code> 为自己帐号相应信息。之后输入</p>
<div class="highlight"><pre><span></span><code>$ systemctl enable --now wpa_supplicant-nl80211@XXXX.service
</code></pre></div>
<p>即可连接。</p>
<p>注：本配置由<a href="http://hep.tsinghua.edu.cn/~orv">orv</a>贡献。</p>
<h4 id="iwd">iwd<a class="headerlink" href="#iwd" title="Permanent link">&para;</a></h4>
<p>由于 Tsinghua-Secure 的证书问题（dhparams 中 p 的长度仅为 1024，不符合 <a href="https://elixir.bootlin.com/linux/v6.0/source/crypto/dh.c#L52">Linux 内核的 1536 长度需求</a>），而 iwd 依赖于内核的密码学工具，默认使用 iwd 无法连接。</p>
<p><a href="https://github.com/NickCao">NickCao</a> 为此提供了 <a href="https://github.com/NickCao/dhack">dhack 内核模块</a> 与 ell 工具补丁（如下）；前者通过劫持相应符号实现补丁，后者在 nix 构建软件包时直接替换源码中的参数。用户可以依此类推自行构建内核与工具。</p>
<div class="highlight"><pre><span></span><code>iwd<span class="o">.</span>override <span class="p">{</span>
  <span class="ss">ell</span> <span class="o">=</span> ell<span class="o">.</span>overrideAttrs <span class="p">(</span>_<span class="p">:</span> <span class="p">{</span>
    <span class="ss">postPatch</span> <span class="o">=</span> <span class="s s-Multiline">&#39;&#39;</span>
<span class="s s-Multiline">      substituteInPlace ell/tls-suites.c \</span>
<span class="s s-Multiline">        --replace &#39;params-&gt;prime_len &lt; 192&#39; &#39;params-&gt;prime_len &lt; 128&#39;</span>
<span class="s s-Multiline">    &#39;&#39;</span><span class="p">;</span>
  <span class="p">});</span>
<span class="p">}</span>
</code></pre></div>
<p>另外配置如下</p>
<div class="highlight"><pre><span></span><code>[Security]
EAP-Method=PEAP
EAP-Identity=&lt;username&gt;
EAP-PEAP-Phase2-Method=MSCHAPV2
EAP-PEAP-Phase2-Identity=&lt;username&gt;
EAP-PEAP-Phase2-Password=&lt;passwd&gt;
[Settings]
AutoConnect=true
</code></pre></div>
<h3 id="tsinghua-secure_1">Tsinghua-Secure 仅校内登录方式<a class="headerlink" href="#tsinghua-secure_1" title="Permanent link">&para;</a></h3>
<p>我们注意到，连接 Tsinghua-Secure 后获取的 IPv4 地址会自动进入准出表中，有可能在未预期的情况下挤占掉线已有的准出设备。</p>
<p>经过测试发现，如果在登录时使用的 username 为「username@tsinghua」（例如lh14@tsinghua），那么其登录行为与「仅校内登录」一样。这种情况下v4只有准入，v6有准入与准出。</p>
<p>在使用该方式认证后，笔者测试可以通过「net.tsinghua.edu.cn」进行准出，但有线网中这个行为不一样。</p>
<h2 id="_8">校园网特性讨论<a class="headerlink" href="#_8" title="Permanent link">&para;</a></h2>
<h3 id="_9">二层隔离/邻居发现隔离<a class="headerlink" href="#_9" title="Permanent link">&para;</a></h3>
<p>校园网的一大特性，是二层隔离/邻居发现隔离。对于v4来说，是前者；对于v6来说，是后者。这个机制为了安全而设计，但对不少开发者/使用者来说较为不方便。</p>
<p>这个特性本质上是核心交换机对广播域进行了划分，甚至使得只有一个客户端与网关在一个广播域中。</p>
<h4 id="ipv4">IPv4<a class="headerlink" href="#ipv4" title="Permanent link">&para;</a></h4>
<p>当我们分配到例如 59.66.130.xx/24 的 IP 时，如果我们想连接 59.66.130.yy/24，我们可能会发现无法连接。注意到这两个在一个 /24 中，即一个二层中，这种情况下两台机器会通过ARP发现对方，但在学校的一些机制下，ARP不能工作。</p>
<p>这种情况下，需要在两台机器上增加以下路由。</p>
<div class="highlight"><pre><span></span><code>ip<span class="w"> </span>r<span class="w"> </span>a<span class="w"> </span><span class="m">59</span>.66.130.0/24<span class="w"> </span>via<span class="w"> </span><span class="m">59</span>.66.130.1
ip<span class="w"> </span>r<span class="w"> </span>a<span class="w"> </span><span class="m">59</span>.66.130.1<span class="w"> </span>dev<span class="w"> </span>eth0
</code></pre></div>
<p>需要根据实际情况修改相应参数。</p>
<h4 id="ipv6">IPv6<a class="headerlink" href="#ipv6" title="Permanent link">&para;</a></h4>
<p>紫荆的 IPv6 不存在该问题，由于其地址是 /128 的。</p>
<p>当我们在一个 Tsinghua-Secure 下时，我们会通过 SLAAC 分配地址，即大家的地址都在一个同一个 /64 下，当互相之间想通信时，需要通过 NDP 进行发现。由于校园网的一些机制，NDP可能不会成功。</p>
<p>这种情况下，需要在两台机器上增加以下路由</p>
<p><div class="highlight"><pre><span></span><code>ip<span class="w"> </span>r<span class="w"> </span>a<span class="w"> </span><span class="m">2402</span>:f000:2:b801::/64<span class="w"> </span>via<span class="w"> </span>fe80::xxxx<span class="w"> </span>dev<span class="w"> </span>wlan0
</code></pre></div>
参数需要根据实际情况确认，第一个为 /64 的前缀，可以参考获得的地址或者参考 RA 来书写，第二个为网关的 LL 地址，与默认路由中显示的地址相同，第三个为无线网卡。</p>
<h3 id="_10">低端口阻断<a class="headerlink" href="#_10" title="Permanent link">&para;</a></h3>
<p>按照前面的「使用简介」文档，IPv4 对 0 到 1024，8000 到 8100，3389 以及 9100 端口进行阻断。另外由于众所周知的原因，1080、4781、7890 端口也被阻断。</p>
<p>2022 年秋季开始，IPv6 对低端口部分进行阻断。</p>
<h3 id="ip">动态 IP<a class="headerlink" href="#ip" title="Permanent link">&para;</a></h3>
<p>对于动态IP，我们可以使用 DDNS 解决，各大提供商，例如 DNSPod，dns.he.net，cloudflare 都提供了该服务。</p>
<p>以 dns.he.net 为例，先增加一个 A/AAAA 记录，并选择使用 DDNS，创建好后创建更新 Token，记为 T。我们书写以下脚本</p>
<p><div class="highlight"><pre><span></span><code>#!/bin/sh
curl -4 &quot;https://domain.example.com:T@dyn.dns.he.net/nic/update?hostname=domain.example.com&quot;
</code></pre></div>
注意Token为其中的T。其余参数按照需要修改。</p>
<p>并用 cron 定期执行该脚本，例如每五分钟一次。可以参考 <a href="https://crontab.guru/">https://crontab.guru/</a> 命令获取具体阐释。</p>
<h4 id="ipv6-ipv6">IPv6 静态后缀或短 IPv6 地址<a class="headerlink" href="#ipv6-ipv6" title="Permanent link">&para;</a></h4>
<p>我们知道，在 SLAAC 下（常见于Tsinghua-Secure），IPv6 地址的后64位可以由客户端自行决定，这时我们可以配置静态后缀，乃至短后缀，如果一个机器只在一个地点下，几乎可以认为前缀固定（需要验证）。</p>
<p>（吐槽：token 这套工具，几乎不在标准里面被提及，文档也少（IPv6 的文档本来就少），还是很小众的东西；毕竟谁需要静态后缀呢，同一个子网下的机器，与其使用静态后缀进行通信（没错，没有只有后缀的路由项，所以到网内另一台机器需要时刻加上前缀），不如配一个静态的私有地址）</p>
<p>往常我们分配到的 IPv6 较复杂，这是因为使用了 EUI64 或者隐私扩展，对于EUI64，可以在地址中发现 <code>ff:fe</code> 的字段。</p>
<p>我们可以通过 iproute2 或传统套件配置静态后缀，后者的使用方法请谷歌，前者的方法在此给出。</p>
<div class="highlight"><pre><span></span><code>ip<span class="w"> </span>token<span class="w"> </span><span class="nb">set</span><span class="w"> </span>::114:514:1919:810/64<span class="w"> </span>dev<span class="w"> </span>wlan0
</code></pre></div>
<p>在运行此命令 <strong>之前</strong>，我们需要注意，我们需要将网卡的 <code>forwarding</code> 关闭（ <strong>在配置时</strong> ，配置后可以打开转发），并打开 <code>accept_ra</code> 与 <code>autoconf</code>，并将其他 dhcp 客户端的 v6 功能关闭。</p>
<p>（吐槽：dhcpcd 虽然说是个 dhcp 客户端，它把 SLAAC 的事情也接管了，就很恼。按照传统只需要开了 <code>accept_ra</code> 与 <code>autoconf</code>，Linux 内核就会自动配置v6地址。如果 <code>forwarding=1</code>时，我们需要使 <code>accept_ra=2</code>）</p>
<div class="highlight"><pre><span></span><code>sysctl<span class="w"> </span>net/ipv6/conf/wlan0/accept_ra<span class="o">=</span><span class="m">1</span>
sysctl<span class="w"> </span>net/ipv6/conf/wlan0/autoconf<span class="o">=</span><span class="m">1</span>
sysctl<span class="w"> </span>net/ipv6/conf/wlan0/forwarding<span class="o">=</span><span class="m">0</span>
</code></pre></div>
<p>以上命令的一些参数请按需替换。我们可以将以上命令放在启动脚本中，使得自动配置 token。</p>
<h4 id="ipv4ipv6">尝试获取某一特定IPv4、IPv6地址<a class="headerlink" href="#ipv4ipv6" title="Permanent link">&para;</a></h4>
<p>你校对于DHCP请求（v4与v6术语不同，不严谨表述）中的特定地址请求是宽容的。</p>
<p>dhcpcd 配置</p>
<div class="highlight"><pre><span></span><code>interface enp3s0
request 59.66.190.254
ia_na 64:1a:ff:ff/2402:f000:4:3:888:1926:8:17
</code></pre></div>
<p>配置中某些信息已经经过编辑，请参考 man page 与实际网络环境来进行配置。</p>
<p>以下附上一些 log，来探究该配置生效的过程。笔者认为，需要在旧 lease 失效或旧地址被人抢占后该配置才能使用。</p>
<div class="highlight"><pre><span></span><code>Apr 02 07:00:21 Zenith dhcpcd[497]: enp3s0: IAID 64:1a:ff:ff
Apr 02 07:00:22 Zenith dhcpcd[497]: enp3s0: soliciting a DHCP lease (requesting 59.66.190.254)
Apr 02 07:00:22 Zenith dhcpcd[497]: enp3s0: offered 59.66.190.254 from 166.111.8.9
Apr 02 07:00:22 Zenith dhcpcd[497]: enp3s0: probing address 59.66.190.254/24
Apr 02 07:00:22 Zenith dhcpcd[497]: enp3s0: confirming prior DHCPv6 lease
Apr 02 07:00:32 Zenith dhcpcd[497]: enp3s0: failed to confirm prior DHCPv6 address
Apr 02 07:00:32 Zenith dhcpcd[497]: enp3s0: adding default route via fe80::9629:2fff:fe37:xxxx
Apr 02 07:00:33 Zenith dhcpcd[497]: enp3s0: ADV 2402:f000:4:3:888:1926:8:17/128 from fe80::9629:2fff:fe37:xxxx
Apr 02 07:00:34 Zenith dhcpcd[497]: enp3s0: REPLY6 received from fe80::9629:2fff:fe37:ffff
Apr 02 07:00:34 Zenith dhcpcd[497]: enp3s0: adding address 2402:f000:4:3:888:1926:8:17/128
</code></pre></div>
<h3 id="ipv6_1">院系网（三层接入）的 IPv6<a class="headerlink" href="#ipv6_1" title="Permanent link">&para;</a></h3>
<p>有些院系网是三层接入的校园网在网内配置的是 SLAAC。</p>
<p>一些机器（例如 Windows 的默认设置和一些 Linux 的默认设置）配置了隐私扩展后，在 SLAAC 环境下其 IPv6 地址会不断改变，由于学校的准入是对 IPv6 地址进行的，具体表现就是在用 auth6 准入 IPv6 一段时间后就失去了准入，需要重新登录 auth6。</p>
<p>一种方法是关掉 IPv6 隐私临时地址（可 Google 查阅相关资料），另一种方式是使用自动准入客户端，例如前面提到的 auth-thu 的 goauthing6.service</p>
<h3 id="systemd-networkd-ipv4">systemd-networkd 有线连接时无法获取 ipv4 地址<a class="headerlink" href="#systemd-networkd-ipv4" title="Permanent link">&para;</a></h3>
<p>清华校园网 DHCPv4 服务器不接受非 mac 地址的 client id，而 systemd-networkd 默认使用 duid。因而 systemd-networkd 获取不到 ip。</p>
<p>解决方案：在 <code>/etc/systemd/network/&lt;your wired network&gt;.network</code> 中加入</p>
<div class="highlight"><pre><span></span><code>[DHCP]
ClientIdentifier=mac
</code></pre></div>
<h3 id="rfc-dhcpv6">不符合 RFC 的 DHCPv6<a class="headerlink" href="#rfc-dhcpv6" title="Permanent link">&para;</a></h3>
<blockquote>
<p>你校的 DHCPv6 server 会不承认某些 DUID，对于这样的 DHCP 请求会不予回应。即使向学校反映该问题，学校尝试让厂商修复后，该问题仍然存在。</p>
<p>根据相关人士消息，只有 DUID Type 1，也就是 DUID-LLT 被承认，以下给出 dhcpcd 的相应配置方式。</p>
<p>首先将 <code>/etc/dhcpcd.conf</code> 中的 <code>duid</code> 打开，同时保证没有开启 <code>clientid</code>。然后我们检查下列文件</p>
<div class="highlight"><pre><span></span><code>$ cat /var/lib/dhcpcd/duid
00:01:00:01:26:53:6d:9d:ff:ff:ff:ff:ff:ff
</code></pre></div>
<p>若以 <code>00:01</code> 开头，则表明为 DUID-LLT，否则（或文件不存在）需要改为上述格式。同时需要检查一下最后的 <code>ff:ff:ff:ff:ff:ff</code> 是否为相关网卡的MAC地址，如果不是需要更改为相应地址。</p>
<p><strong>更新</strong> 的测试发现，我们并不知道你校的 DHCPv6 是如何工作的，其如何工作完全是玄学。有的开启了 Anonymize 即可使用，有的开启了也尝试失败。</p>
<p>一些体验可以参考 <a href="https://pwe.cat/zijing-dhcpv6/">https://pwe.cat/zijing-dhcpv6/</a></p>
</blockquote>
<p>最近的尝试发现，使用较新版本的 <code>systemd-networkd</code> 能稳定获取地址。</p>
<h3 id="30">30分钟无流量掉准入<a class="headerlink" href="#30" title="Permanent link">&para;</a></h3>
<p>根据之前提到的《准入上网使用说明》，计算机长时间（目前为 30 分钟）不使用网络时，认证系统会关闭其网络连接； <del>服务器如有必要可每 10 分钟 ping 1 次 ping.tsinghua.edu.cn。</del>（已失效）</p>
<h3 id="_11">掉准出后无法准出<a class="headerlink" href="#_11" title="Permanent link">&para;</a></h3>
<p>某些长久运行的机器可能掉准出，即无法连接校外网。这种情况下，不少同学可能在 usereg 或命令行中尝试 <strong>准出</strong> ，但是发现准出不成功。 <strong>在 usereg 上，即使显示机器在准出表中，在机器上也无法访问校外网</strong> 。我们认为这是校园网的某些设备的状态同步可能出现了问题。</p>
<p>对于这种问题，有一种可能的解决尝试，就是先将登出 <strong>准入</strong> ，然后再准入并准出，这样可能会刷新学校某些机器的状态，从而使得准出能成功。注意！登出准入是非常危险的操作！您可能会经历 ssh 断线，从而与机器永久失联！请在充分了解该操作的意义与知道如何在登出准入后恢复准入的情况下操作！</p>
<h3 id="_12">准入后（仅校内登录后）无法准出<a class="headerlink" href="#_12" title="Permanent link">&para;</a></h3>
<p>上文中我们提到了 Tsinghua-Secure 仅校内登录的方法，命令行（请查阅相关参数）与网页端（准入界面的仅校内复选框）也有相应的仅校内登录方案。但是有同学观测到在仅校内登录后，通过 net.tsinghua.edu.cn 来进行准出无法准出，usereg 准出也无法成功。这与上面的问题一样应该也是某些设备状态的问题，目前无解。</p>
<h3 id="ping-ssh">未准入时其他机器能 ping 通，但不能 ssh<a class="headerlink" href="#ping-ssh" title="Permanent link">&para;</a></h3>
<p>不能 ssh 是预策略（参考本章校园网基础知识一节中的《清华大学校园网有线局域网用户准入系统使用说明（问与答）》）决定的</p>
<p>能 ping 通也是预策略决定的，不过这一点没有文档；即，未准入时放行 ICMP reply 包。</p>
<h3 id="dns">DNS 拦截<a class="headerlink" href="#dns" title="Permanent link">&para;</a></h3>
<p>校园网（教育网）可能会拦截到一些常见 DNS 服务器的 ICMP 和 DNS 请求，表现为 <code>ping</code> 或 <code>dig</code> 相应地址时延迟异常低 (&lt;1ms)，<code>traceroute</code> 显示包经过少数几跳后在某些属于校园网（教育网）的 IP 地址（118.229.x.y，可能为路由设备）处消失，未进入其他运营商网络。</p>
<p>笔者在宿舍区 (59.66.x.y 网段) 测试了部分公开 DNS 服务器的响应情况，供参考，表中 ping 延迟 &lt;1 的结果提示服务器可能被劫持。注意此类策略可能随时间动态调整，此测试结果可能无法及时更新。从测试结果中大致可总结出以下规律：</p>
<ol>
<li>知名 DNS 提供商的主要 IPv4 地址易受拦截，备用 IPv4 地址 (114, Cloudflare) 、较不规律的 IPv4 地址 (360, Quad9 备用, OpenDNS) 和 IPv6 地址未被拦截，可能与用户请求数量有关；</li>
<li>海外 DNS 提供商的 IPv6 地址响应延迟低于响应的 IPv4 地址，大陆地区的 DNS 部分情况相反，IPv6 地址响应速度整体偏慢。校园网 DNS 和 TUNA 响应速度一骑绝尘。</li>
</ol>
<table>
<thead>
<tr>
<th>DNS 厂商</th>
<th>IP 地址</th>
<th>ping 延迟 (ms)</th>
<th>dig 延迟 (ms)</th>
</tr>
</thead>
<tbody>
<tr>
<td>校园网</td>
<td>166.111.8.28</td>
<td>&lt;1</td>
<td></td>
</tr>
<tr>
<td></td>
<td>166.111.8.29</td>
<td>&lt;1</td>
<td></td>
</tr>
<tr>
<td></td>
<td>2402:f000:1:801::8:28</td>
<td>&lt;1</td>
<td></td>
</tr>
<tr>
<td></td>
<td>2402:f000:1:801::8:29</td>
<td>&lt;1</td>
<td></td>
</tr>
<tr>
<td>114</td>
<td>114.114.114.114</td>
<td>&lt;1</td>
<td></td>
</tr>
<tr>
<td></td>
<td>114.114.115.115</td>
<td>9</td>
<td>7</td>
</tr>
<tr>
<td>360</td>
<td>101.226.4.6</td>
<td>28</td>
<td>31</td>
</tr>
<tr>
<td></td>
<td>218.30.118.6</td>
<td>34</td>
<td>35</td>
</tr>
<tr>
<td></td>
<td>140.207.198.6</td>
<td>25</td>
<td>27</td>
</tr>
<tr>
<td></td>
<td>123.125.81.6</td>
<td>3</td>
<td>3</td>
</tr>
<tr>
<td>阿里</td>
<td>223.5.5.5</td>
<td>&lt;1</td>
<td></td>
</tr>
<tr>
<td></td>
<td>223.6.6.6</td>
<td>&lt;1</td>
<td></td>
</tr>
<tr>
<td></td>
<td>2400:3200::1</td>
<td>3</td>
<td>3</td>
</tr>
<tr>
<td></td>
<td>2400:3200:baba::1</td>
<td>3</td>
<td>3</td>
</tr>
<tr>
<td>百度</td>
<td>180.76.76.76</td>
<td>&lt;1</td>
<td></td>
</tr>
<tr>
<td>腾讯 DNSPod</td>
<td>119.29.29.29</td>
<td>&lt;1</td>
<td></td>
</tr>
<tr>
<td></td>
<td>2402:4e00::</td>
<td>54</td>
<td>51</td>
</tr>
<tr>
<td></td>
<td>2402:4e00:1::</td>
<td>56</td>
<td>51</td>
</tr>
<tr>
<td>天地互连</td>
<td>240c::6666</td>
<td>40</td>
<td>159</td>
</tr>
<tr>
<td></td>
<td>240c::6644</td>
<td>36</td>
<td>55</td>
</tr>
<tr>
<td>TUNA DNS666</td>
<td>101.6.6.6</td>
<td>不响应</td>
<td>3</td>
</tr>
<tr>
<td></td>
<td>2001:da8::666</td>
<td>1</td>
<td>1</td>
</tr>
<tr>
<td>谷歌</td>
<td>8.8.8.8</td>
<td>&lt;1</td>
<td></td>
</tr>
<tr>
<td></td>
<td>8.8.4.4</td>
<td>&lt;1</td>
<td></td>
</tr>
<tr>
<td></td>
<td>2001:4860:4860::8888</td>
<td>36</td>
<td>40</td>
</tr>
<tr>
<td></td>
<td>2001:4860:4860::8844</td>
<td>36</td>
<td>39</td>
</tr>
<tr>
<td>Cloudflare</td>
<td>1.1.1.1</td>
<td>&lt;1</td>
<td></td>
</tr>
<tr>
<td></td>
<td>1.0.0.1</td>
<td>170</td>
<td>171</td>
</tr>
<tr>
<td></td>
<td>2606:4700:4700::1111</td>
<td>38</td>
<td>51</td>
</tr>
<tr>
<td></td>
<td>2606:4700:4700::1001</td>
<td>38</td>
<td>47</td>
</tr>
<tr>
<td>Quad9</td>
<td>9.9.9.9</td>
<td>&lt;1</td>
<td></td>
</tr>
<tr>
<td></td>
<td>149.112.112.112</td>
<td>170</td>
<td>167</td>
</tr>
<tr>
<td></td>
<td>2620:fe::9</td>
<td>37</td>
<td>35</td>
</tr>
<tr>
<td></td>
<td>2620:fe::fe</td>
<td>38</td>
<td>39</td>
</tr>
<tr>
<td>OpenDNS</td>
<td>208.67.222.222</td>
<td>170</td>
<td>183</td>
</tr>
<tr>
<td></td>
<td>208.67.220.220</td>
<td>170</td>
<td>179</td>
</tr>
</tbody>
</table>
<p>注:</p>
<ol>
<li><code>dig</code> 使用笔者托管在 Cloudflare 上的某个域名测试，多次测量取较小值；</li>
<li>360 “安全” DNS 未收录笔者的域名，返回了空的 A 和 AAAA 记录查询结果；</li>
<li>部分 <code>dig</code> 测试延迟略低于 <code>ping</code> RTT，可能是由于二者计时方式不同或网络波动所致。</li>
</ol>
<p>本测试受 <a href="https://www.usenix.org/conference/usenixsecurity18/presentation/liu-baojun">Who Is Answering My Queries: Understanding and Characterizing Interception of the DNS Resolution Path</a> 启发，该论文对 DNS 拦截现象进行了更深入全面的研究。</p>
<h2 id="_13">清华云盘<a class="headerlink" href="#_13" title="Permanent link">&para;</a></h2>
<p>建议使用 <a href="https://seafile.com/download">seafile.com/download</a> 中的 Linux 客户端，而不是 Terminal 客户端，因为 Terminal 客户端需要独立密码，此密码不同于 INFO 密码，不能获得，故不能通过 Terminal 客户端登录。</p>
<p>由于手动安装软件的方式是不为推崇的，请使用包管理器获取相应软件。对 Arch Linux 用户，Linux 客户端就是</p>
<div class="highlight"><pre><span></span><code>pacman<span class="w"> </span>-S<span class="w"> </span>seafile-client
</code></pre></div>
<p>而非 <code>pacman -S seafile</code>，此包为 Terminal 客户端。其余发行版请自行找到对应包。</p>
<h3 id="terminal">使用 Terminal 客户端<a class="headerlink" href="#terminal" title="Permanent link">&para;</a></h3>
<p>Terminal 客户端在 8.0.4 版本后以后支持使用 Token 进行同步，你可以在 <a href="https://help.seafile.com/syncing_client/install_linux_client/">install_linux_client</a> 中找到大部分发行版 AMD64 架构的源，如果你所使用的包管理器中 <code>seafile</code> 或 <code>seafile-cli</code> 版本号低于 <code>8.0.4</code>，可以安装并参考后面替换部分文件的方法，也可以直接手动编译最新版。</p>
<h4 id="token">获取 Token<a class="headerlink" href="#token" title="Permanent link">&para;</a></h4>
<p>在浏览器中登录清华云盘，Cookie 中的 <code>seahub_auth</code> 应该为 <code>用户名（学号@tsinghua.edu.cn）@Token</code> 的模式，最后一段即为 Token 。每个账户的 Token 是唯一的，并且不会过期。</p>
<p>在能正常运行 <code>seaf-cli</code> 后，可以使用命令行进行同步操作</p>
<div class="highlight"><pre><span></span><code>seaf-cli init -d ~
seaf-cli start
seaf-cli sync -l &lt;library-id&gt; -s https://cloud.tsinghua.edu.cn -d &lt;place-directory&gt; -T &lt;token&gt;
seaf-cli desync -d &lt;existing-folder&gt;
</code></pre></div>
<h4 id="token_1">替换部分文件实现 Token 登录<a class="headerlink" href="#token_1" title="Permanent link">&para;</a></h4>
<p><code>seaf-cli</code> 实质上是通过 <code>pysearpc</code> 与 <code>seaf-daemon</code> 通讯，因此大部分发行版默认源中较低版本的 <code>seafile</code> 在只替换 <code>seaf-cli</code> 的情况下也能正常工作。这里提供一种安装 Terminal 客户端后替换 <code>seaf-cli</code> 实现 Token 登录的简单办法。</p>
<div class="highlight"><pre><span></span><code>git clone https://github.com/haiwen/seafile
cd seafile
cp app/seaf-cli /usr/bin/seaf-cli
chmod +x /usr/bin/seaf-cli
cp -r python/seafile $(python3 -m site --user-site)
</code></pre></div>
<h4 id="terminal_1">编译 Terminal 客户端<a class="headerlink" href="#terminal_1" title="Permanent link">&para;</a></h4>
<p>具体的编译流程可以参考 <a href="https://manual.seafile.com/build_seafile/linux/">build_seafile</a>，但要注意几点：</p>
<ul>
<li>下载并编译每个仓库中的最新源码或最新的 release</li>
<li>可以忽略文档中的 <code>ccnet</code> 部分，仓库已经消失并且不存在相关依赖</li>
<li>make 有概率失败，可以多来几次</li>
<li>如果安装完成后 <code>seaf-cli</code> 报错，例如 <code>No module named 'seafile'</code> 可以参考上一节手动复制 <code>seafile</code> 包</li>
</ul>
<h3 id="chrome">Chrome 提醒下载的文件危险<a class="headerlink" href="#chrome" title="Permanent link">&para;</a></h3>
<p>此现象可能是奇妙同学的奇妙操作导致 Chrome 将清华云盘域名标记，进而所有文件下载都会提醒可能有危险并阻止。</p>
<p>请忽略此提醒。当然，如果您下载的真的是奇妙的文件，请您自查。</p>
<h2 id="isatap">ISATAP（已停止）<a class="headerlink" href="#isatap" title="Permanent link">&para;</a></h2>
<p>目前，该服务已停止。</p>
<p>参考 <a href="https://ipv6.tsinghua.edu.cn">ipv6.tsinghua.edu.cn</a>。另有 <a href="https://aur.archlinux.org/packages/thu-isatap">AUR 包 thu-isatap</a> 供参考。</p>
<p>目前只有校内公网IPv4的可使用该服务，校外不可。注意 <code>166.111.21.1</code> 这个IP是不会回应ping包的。</p>
<h3 id="ipv6pt">获取IPv6挂PT<a class="headerlink" href="#ipv6pt" title="Permanent link">&para;</a></h3>
<p>由于在家中使用 SSLVPN 后可获得校内公网 IP，可以使用 ISATAP 获取清华 IPv6 地址，以达到挂 PT 的功能，此处不做详细展开。</p>
<h2 id="win-10">WIN 10 激活<a class="headerlink" href="#win-10" title="Permanent link">&para;</a></h2>
<p>在 Linux 下使用该命令获取相关 cmd 指令</p>
<div class="highlight"><pre><span></span><code>$ dig -t TXT win10.harrychen.xyz +short
</code></pre></div>
<p>或在 Windows 下使用</p>
<div class="highlight"><pre><span></span><code>cmd&gt; nslookup -q=TXT win10.harrychen.xyz
</code></pre></div>
<p>然后在连上 sslvpn 的情况下执行该脚本即可激活</p>
<h2 id="_14">正版操作系统与软件下载<a class="headerlink" href="#_14" title="Permanent link">&para;</a></h2>
<h3 id="its">ITS<a class="headerlink" href="#its" title="Permanent link">&para;</a></h3>
<p>访问 <a href="https://its.tsinghua.edu.cn">https://its.tsinghua.edu.cn</a> 登录后即可获得 Win10，杀毒软件，WPS，MS Visio，MS Visual Studio，MATLAB 等正版软件的下载方式</p>
<h3 id="tuna">TUNA<a class="headerlink" href="#tuna" title="Permanent link">&para;</a></h3>
<p>访问 <a href="https://mirrors.tuna.tsinghua.edu.cn">https://mirrors.tuna.tsinghua.edu.cn</a> ，点击获取下载链接即可。</p>
<h2 id="ip_1">校内 IP 段<a class="headerlink" href="#ip_1" title="Permanent link">&para;</a></h2>
<p>校内共有 6 个 /16，可参考 <a href="https://bgp.he.net/AS45576">https://bgp.he.net/AS45576</a></p>
<div class="highlight"><pre><span></span><code>; 重要校园服务基本位于此网段，例如主页
; 机房也常用该网段
; 此网段还可在教学楼、图书馆获取
166.111.0.0/16
; 常用于机房与院系网；在 2024 年 4 月学生区无线网络维护后，该网段也用于无线网
101.5.0.0/16
101.6.0.0/16
; 紫荆，C 楼等学生区，以及南部居民区
59.66.0.0/16
; 无线网（两个 /16 还不够用呢）
183.172.0.0/16
183.173.0.0/16
; 内部使用（大概是供路由器等网络基础设施使用）
118.229.0.0/20
</code></pre></div>
<p>v6 一般使用 <code>2402:f000::/32</code>，也有部分地区使用 <code>2001:250:200::/48</code>（网研院）。有一段 <code>2001:da8:200::/48</code> 但未见使用。</p>







  
    
  
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="最后更新">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">2025年2月26日</span>
  </span>

    
    
    
      
  
  <span class="md-source-file__fact">
    <span class="md-icon" title="贡献者">
      
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 4a4 4 0 0 1 4 4 4 4 0 0 1-4 4 4 4 0 0 1-4-4 4 4 0 0 1 4-4m0 10c4.42 0 8 1.79 8 4v2H4v-2c0-2.21 3.58-4 8-4"/></svg>
      
    </span>
    <nav>
      
        <a href="mailto:c@jia.je">Chen</a>
    </nav>
  </span>

    
    
  </aside>





                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}}</script>
    
    
      <script src="../assets/javascripts/bundle.f13b1293.min.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script>
      
    
  </body>
</html>